# i18n (pt-BR base + en) — decisões e formato

## Objetivo
Adicionar suporte a dois idiomas no site estático, mantendo **pt-BR** como idioma base (fallback) e oferecendo **inglês** via `/?lang=en`.

## Escopo (o que será traduzido)
- Traduzir **todas as páginas possíveis** do repositório (todas as HTML que forem servidas), mantendo consistência do idioma em toda a navegação.
- Por enquanto, traduzir apenas **textos presentes nas páginas** (conteúdo estático no HTML e atributos). Textos gerados por JS ficam fora do escopo inicial, salvo se estiverem claramente isolados/centralizados e fáceis de traduzir.

## Estratégia de URL
- Idioma controlado por query string: `/?lang=en` e `/?lang=pt-BR` (opcional).
- Default: `pt-BR` quando `lang` não estiver presente.
- Todos os links internos devem **preservar** o parâmetro `lang` quando ativo.
- Regra do projeto: **manter sempre o `?lang=`** na URL após o usuário escolher um idioma (para compartilhamento de link e navegação consistente).

## Detecção e persistência do idioma (ordem)
1. Query string `lang` (`pt-BR` | `en`)
2. `localStorage.lang` (salvo quando o usuário troca)
3. Idioma do navegador (`navigator.languages`/`navigator.language`)
4. Default `pt-BR`

### Regra para idioma do navegador
- Se o idioma do navegador **não** for português (`pt`, `pt-BR`, `pt-PT`, etc), o site deve iniciar em **inglês** (`en`) automaticamente.

## Estrutura de arquivos (proposta)
- `scripts/i18n.js`
  - Carrega o dicionário, aplica no DOM, faz fallback para `pt-BR`, fornece função `t()`.
- `locales/pt-BR.json` (fonte de verdade / base)
- `locales/en.json` (tradução)

## Formato do dicionário (implementado)
- O `locales/en.json` contém `strings` onde:
  - **chave** = texto original em pt-BR (como aparece no HTML/atributos)
  - **valor** = tradução em inglês
- O `locales/pt-BR.json` existe, mas por padrão fica vazio, porque o conteúdo base já está no HTML.
- O runtime deve permitir alternar `en` ⇄ `pt-BR` sem recarregar, restaurando os textos originais ao voltar para `pt-BR`.

## Aplicação no HTML (implementado)
- Tradução de:
  - nós de texto (text nodes) fora de `script/style/noscript/svg`
  - atributos: `alt`, `aria-label`, `title`, `placeholder`
  - `<meta name="description">` via mapa específico (`meta.description`)

### Elemento `<html lang="">`
- `i18n.js` deve setar `document.documentElement.lang` para `pt-BR` ou `en`.

## API JS (implementado)
- `window.i18n = { getLang, setLang, withLang, apply }`
  - `setLang(lang)`: persiste, atualiza `?lang=` e reaplica as traduções.
  - `withLang(url)`: retorna uma URL interna com `?lang=<atual>`.
  - `apply(root?)`: reaplica traduções em um subtree (útil para conteúdo inserido por JS).

## Interpolação e pluralização (fora do MVP atual)
- No formato atual (mapeando strings pt-BR → en), não há suporte a interpolação/pluralização.
- Se ficar necessário, a próxima evolução é migrar partes do site para chaves estáveis (ex.: `home.hero.title`) e adicionar `t()` com interpolação.

## Comportamento para chaves faltando
- Se não existir em `en.json`, usar `pt-BR.json`.
- Se não existir em `pt-BR.json`, mostrar um placeholder como `[i18n:missing home.hero.title]` e logar `console.warn` (modo dev).

## Metadados / head
- `document.title` deve vir de uma chave por página (ex.: `home.meta.title`).
- Descrição (`<meta name="description">`) e outros atributos podem ser tratados via `data-i18n-attr` no próprio `<meta>`.

## Seletor de idioma (UX)
- Um seletor simples (`PT` / `EN`) em local consistente **em todas as páginas** (topo/rodapé).
- Ao trocar:
  - Atualizar query string `lang` sem quebrar navegação.
  - Salvar `localStorage.lang`.
  - Reaplicar traduções no DOM atual.

## Fora de escopo (por enquanto)
- Rotas dedicadas tipo `/en/` (melhor para SEO, mas exige duplicação/roteamento).
- Detecção por `Accept-Language` (server-side).
